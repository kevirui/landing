---
import Logo from './components/Logo.astro';
import Navigation from './components/Navigation.astro';
import LanguageSwitcher from './components/LanguageSwitcher';
import ThemeToggle from './components/ThemeToggle';
import type { Language } from '@custom-types/index';

interface Props {
  lang: Language;
  isHomePage?: boolean;
}

const { lang, isHomePage = false } = Astro.props;

const positionClass = isHomePage ? 'fixed' : 'sticky';
const translateClass = isHomePage ? '-translate-y-full' : 'translate-y-0';
---

<header
  id="main-header"
  class={`w-full text-white ${positionClass} top-0 z-50 px-3 sm:px-4 md:px-6 lg:px-8 xl:px-12 py-2 sm:py-3 transition-transform duration-300 ${translateClass} bg-primary-dark dark:bg-primary`}
  data-is-home={isHomePage}
>
  <div class="max-w-7xl mx-auto grid grid-cols-3 items-center gap-2 sm:gap-4">
    <div class="flex justify-start">
      <Logo lang={lang} />
    </div>

    <div class="hidden md:flex justify-center">
      <Navigation lang={lang} />
    </div>

    <div class="flex justify-end items-center gap-2">
      <ThemeToggle client:only="react" />
      <LanguageSwitcher client:only="react" />
    </div>
  </div>
</header>
<script>
  const header = document.getElementById('main-header');
  const isHomePage = header?.getAttribute('data-is-home') === 'true';

  if (isHomePage) {
    // Solo en la página principal: ocultar cuando el hero esté visible
    const hero = document.getElementById('hero');

    if (header && hero) {
      const observer = new IntersectionObserver(
        entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              // Hero is visible -> Hide header
              header.classList.add('-translate-y-full');
              header.classList.remove('translate-y-0');
            } else {
              // Hero is not visible -> Show header
              header.classList.remove('-translate-y-full');
              header.classList.add('translate-y-0');
            }
          });
        },
        {
          root: null, // viewport
          threshold: 0, // trigger as soon as even 1px is visible (or not)
        }
      );

      observer.observe(hero);
    }
  } else {
    // En otras páginas: siempre visible
    if (header) {
      header.classList.remove('-translate-y-full');
      header.classList.add('translate-y-0');
    }
  }
</script>
