---
import Logo from '@components/common/Logo.astro';
import Navigation from '@components/common/Navigation.astro';
import LanguageSwitcher from '@components/common/LanguageSwitcher';
import type { Language } from '../types/language.type';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
---

<header
  id="main-header"
  class="w-full bg-green-900/40 backdrop-blur-sm fixed top-0 z-50 px-3 sm:px-4 md:px-6 lg:px-8 xl:px-12 py-2 sm:py-3 transition-transform duration-300 -translate-y-full"
>
  <div class="max-w-7xl mx-auto grid grid-cols-3 items-center gap-2 sm:gap-4">
    <div class="flex justify-start">
      <Logo lang={lang} />
    </div>

    <div class="hidden md:flex justify-center">
      <Navigation lang={lang} />
    </div>

    <div class="flex justify-end">
      <LanguageSwitcher client:load />
    </div>
  </div>
</header>
<script>
  const header = document.getElementById('main-header');
  const hero = document.getElementById('hero');

  if (header && hero) {
    const observer = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // Hero is visible -> Hide header
            header.classList.add('-translate-y-full');
            header.classList.remove('translate-y-0');
          } else {
            // Hero is not visible -> Show header
            header.classList.remove('-translate-y-full');
            header.classList.add('translate-y-0');
          }
        });
      },
      {
        root: null, // viewport
        threshold: 0, // trigger as soon as even 1px is visible (or not)
        // rootMargin: We might want it to trigger when Hero is ALMOST out.
        // But the requirement says "no se vea... en el nivel donde est√° el hero".
        // simple threshold 0 means: if any part of Hero is visible, isIntersecting = true.
      }
    );

    observer.observe(hero);
  } else {
    // Fallback if hero not found (e.g. inner pages without hero?)
    // If we are on a page without hero, we probably want the header to be visible always.
    if (header && !hero) {
      header.classList.remove('-translate-y-full');
    }
  }
</script>
